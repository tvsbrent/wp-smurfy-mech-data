var SmurfyApp={urlBase:window.location.href,cachedChassis:{},cachedLoadouts:{},useCompactStats:false,useCompactComponents:false,Breakpoints:{stats:580,image:715,components:755},AjaxSettings:function(url){this.url=url;this.timeout=7500;this.type="GET";this.async=true;this.contentType="application/json";this.dataType="json"},DataID:function(chassisID,loadoutID){this.chassis=chassisID;this.loadout=loadoutID},errorMessage:{currentExpander:null,currentTimeOut:0},ExpanderBaseClass:"dsmd-expander",ExpanderStateClasses:{open:"dsmd-expander-arrow-down",close:"dsmd-expander-arrow-up",loading:"dsmd-expander-loading",error:"dsmd-expander-error"},ImageState:{hidden:0,faded:1,visible:2},currentImageState:2,PanelType:{stats:0,components:1},Months:["January","February","March","April","May","June","July","August","September","October","November","December"]};SmurfyApp.DataID.prototype.key=function(){return this.chassis+":"+this.loadout};SmurfyApp.DataID.prototype.allURL=function(){return SmurfyApp.urlBase+"?display-smurfy-mech-data-all="+this.chassis+":"+this.loadout};SmurfyApp.DataID.prototype.loadoutURL=function(){return SmurfyApp.urlBase+"?display-smurfy-mech-data-loadout="+this.chassis+":"+this.loadout};SmurfyApp.roundValue=function(value){return Math.round((value+1e-5)*100)/100};SmurfyApp.parseCreateDate=function(createDate){var s=createDate.substr(0,createDate.indexOf("T")).split("-");return SmurfyApp.Months[s[1]-1]+" "+s[2]+", "+s[0]};SmurfyApp.parseUri=function(str){var o=SmurfyApp.parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||"";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2});return uri};SmurfyApp.parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};SmurfyApp.getURLParameter=function(url,name){return(RegExp(name+"="+"(.+?)(&|$)").exec(url)||[,null])[1]};SmurfyApp.getChassisAndLoadoutID=function(expander,dataID){var sibs=expander.siblings("a");for(var i=0,url="";i<sibs.length;++i){url=jQuery(sibs[i]).attr("href");dataID.chassis=this.getURLParameter(url,"i");dataID.loadout=this.getURLParameter(url,"l");break}if(dataID.chassis===null||dataID.loadout===null){return false}return true};SmurfyApp.setExpanderState=function(expander,state){expander.attr("class",SmurfyApp.ExpanderBaseClass+" "+SmurfyApp.ExpanderStateClasses[state])};SmurfyApp.hasExpanderStateClasses=function(expander,state){return expander.hasClass(SmurfyApp.ExpanderStateClasses[state])};SmurfyApp.handleError=function(expander,errorMsg){SmurfyApp.setExpanderState(expander,"error");expander.off("click");expander.data("error-msg",errorMsg);expander.hover(function(){SmurfyApp.showExpanderError(jQuery(this))},function(){SmurfyApp.hideExpanderError()});SmurfyApp.showExpanderError(expander)};SmurfyApp.showExpanderError=function(expander){window.clearTimeout(SmurfyApp.errorMessage.currentTimeOut);if(SmurfyApp.errorMessage.currentExpander!==expander){SmurfyApp.errorMessage.text(expander.data("error-msg")).currentExpander=expander;SmurfyApp.positionExpanderError(expander)}SmurfyApp.errorMessage.css({"z-index":10}).addClass("dsmd-expander-visible")};SmurfyApp.hideExpanderError=function(){SmurfyApp.errorMessage.removeClass("dsmd-expander-visible").currentTimeOut=window.setTimeout(function(){SmurfyApp.errorMessage.css({"z-index":-10}).currentExpander=null},250)};SmurfyApp.positionExpanderError=function(expander){var expanderOffset=expander.offset();SmurfyApp.errorMessage.css({top:expanderOffset.top+expander.height()*2,left:expanderOffset.left+expander.width()-SmurfyApp.errorMessage.width()})};SmurfyApp.handleResizeComplete=function(){var isFirst=true;var updatedImageState=false,updateCompactStatsState=false,updateCompactComponentState=false;jQuery(".dsmd-container").each(function(){if(isFirst){isFirst=false;var containerWidth=jQuery(this).width();updatedImageState=SmurfyApp.updateImageState(containerWidth);updateCompactStatsState=SmurfyApp.updateCompactStatsState(containerWidth);updateCompactComponentState=SmurfyApp.updateCompactComponentState(containerWidth);if(!updatedImageState&&!updateCompactStatsState&&!updateCompactComponentState){return false}}SmurfyApp.resizeContainerElements(jQuery(this),updatedImageState,updateCompactStatsState,updateCompactComponentState)});if(SmurfyApp.errorMessage.currentExpander!==null){SmurfyApp.positionExpanderError(SmurfyApp.errorMessage.currentExpander)}else{SmurfyApp.errorMessage.css({top:0,left:0})}if(updateCompactStatsState){var anchorUpdater=function(panelType,newText){jQuery("body").find('a[data-display-panel-type="'+panelType+'"]').text(newText)};if(SmurfyApp.useCompactStats){anchorUpdater(SmurfyApp.PanelType.stats,"S");anchorUpdater(SmurfyApp.PanelType.components,"C")}else{anchorUpdater(SmurfyApp.PanelType.stats,"Stats");anchorUpdater(SmurfyApp.PanelType.components,"Components")}}};SmurfyApp.updateImageState=function(containerWidth){if(containerWidth>=SmurfyApp.Breakpoints.image&&SmurfyApp.currentImageState!=SmurfyApp.ImageState.visible){SmurfyApp.currentImageState=SmurfyApp.ImageState.visible;return true}else if(containerWidth<SmurfyApp.Breakpoints.image&&SmurfyApp.currentImageState!=SmurfyApp.ImageState.faded){SmurfyApp.currentImageState=SmurfyApp.ImageState.faded;return true}return false};SmurfyApp.updateCompactStatsState=function(containerWidth){if(containerWidth<SmurfyApp.Breakpoints.stats&&!SmurfyApp.useCompactStats){SmurfyApp.useCompactStats=true;return true}else if(containerWidth>=SmurfyApp.Breakpoints.stats&&SmurfyApp.useCompactStats){SmurfyApp.useCompactStats=false;return true}return false};SmurfyApp.updateCompactComponentState=function(containerWidth){if(containerWidth<SmurfyApp.Breakpoints.components&&!SmurfyApp.useCompactComponents){SmurfyApp.useCompactComponents=true;return true}else if(containerWidth>=SmurfyApp.Breakpoints.components&&SmurfyApp.useCompactComponents){SmurfyApp.useCompactComponents=false;return true}return false};SmurfyApp.resizeContainerElements=function(container,updatedImageFadedState,updatedCompactState,updatedCompactComponentsState){if(updatedImageFadedState){switch(SmurfyApp.currentImageState){case SmurfyApp.ImageState.hidden:container.find(".dsmd-mech-image").addClass("dsmd-hidden").removeClass("dsmd-compact");break;case SmurfyApp.ImageState.faded:container.find(".dsmd-mech-image").addClass("dsmd-compact").removeClass("dsmd-hidden");break;case SmurfyApp.ImageState.visible:container.find(".dsmd-mech-image").removeClass("dsmd-compact").removeClass("dsmd-hidden");break;default:throw"Unsupported image state!";break}}if(updatedCompactState){if(SmurfyApp.useCompactStats){container.find("span:not(.dsmd-mech-image)").addClass("dsmd-compact");container.find('.dsmd-panel[data-panel-type="'+SmurfyApp.PanelType.stats+'"]').children(":not(.dsmd-mech-image)").addClass("dsmd-compact")}else{container.find("span:not(.dsmd-mech-image)").removeClass("dsmd-compact");container.find('.dsmd-panel[data-panel-type="'+SmurfyApp.PanelType.stats+'"]').children(":not(.dsmd-mech-image)").removeClass("dsmd-compact")}}if(updatedCompactComponentsState){var selectedPanel=container.attr("data-selected-panel");if(selectedPanel==SmurfyApp.PanelType.components){var panelCompact=container.find('.dsmd-panel.dsmd-compact[data-panel-type="'+SmurfyApp.PanelType.components+'"]'),panelNormal=container.find('.dsmd-panel:not(.dsmd-compact)[data-panel-type="'+SmurfyApp.PanelType.components+'"]'),panelSwitcher=function(panelOld,panelNew){panelOld.addClass("dsmd-hidden");if(!panelNew.length){var dataID=new SmurfyApp.DataID(container.data("chassis-id"),container.data("loadout-id"));container.append(SmurfyApp.appendMechComponentsPanel(container,dataID))}else{panelNew.removeClass("dsmd-hidden")}};if(SmurfyApp.useCompactComponents){panelSwitcher(panelNormal,panelCompact)}else{panelSwitcher(panelCompact,panelNormal)}}}};SmurfyApp.getMechData=function(container,expander){try{var dataID=new SmurfyApp.DataID;container.on("dataReady",function(){container.off("dataReady");SmurfyApp.buildViewBody(container,dataID);SmurfyApp.appendMechStatsPanel(container,dataID);container.attr("data-selected-panel",SmurfyApp.PanelType.stats).attr("data-chassis-id",dataID.chassis).attr("data-loadout-id",dataID.loadout);window.setTimeout(function(){container.attr("data-built-view","true").trigger("viewBuilt")},250)});if(!SmurfyApp.getChassisAndLoadoutID(expander,dataID)){throw"Failed to find Chassis or Loadout ID."}if(!SmurfyApp.cachedChassis.hasOwnProperty(dataID.chassis)){jQuery.ajax(new SmurfyApp.AjaxSettings(dataID.allURL())).done(function(response,textStatus,jqXHR){SmurfyApp.cachedChassis[dataID.chassis]=response.chassis;SmurfyApp.cachedLoadouts[dataID.key()]=response.loadout;container.trigger("dataReady")}).fail(function(jqXHR,textStatus,errorThrown){SmurfyApp.handleError(expander,"Failed to retrieve chassis and loadout data.")})}else if(!SmurfyApp.cachedLoadouts.hasOwnProperty(dataID.key())){jQuery.ajax(new SmurfyApp.AjaxSettings(dataID.loadoutURL())).done(function(response){SmurfyApp.cachedLoadouts[dataID.key()]=response.loadout;container.trigger("dataReady")}).fail(function(){SmurfyApp.handleError(expander,"Failed to retrieve loadout data.")})}else{container.trigger("dataReady")}}catch(errorMsg){SmurfyApp.handleError(expander,errorMsg)}};SmurfyApp.buildViewBody=function(container,dataID){var chassisData=SmurfyApp.cachedChassis[dataID.chassis],loadoutData=SmurfyApp.cachedLoadouts[dataID.key()],displayData={isCompact:SmurfyApp.useCompactStats,compactClass:SmurfyApp.useCompactStats?"dsmd-compact":""};container.append(SmurfyApp.viewBodyTemplate(displayData));container.find("a[data-display-panel-type]").on("click",SmurfyApp.anchorClickHandler)};SmurfyApp.appendMechStatsPanel=function(container,dataID){var chassisData=SmurfyApp.cachedChassis[dataID.chassis];var loadoutData=SmurfyApp.cachedLoadouts[dataID.key()];var viewBody=container.find(".dsmd-body");_.each(loadoutData.stats.armaments,function(armament){if(!armament.hasOwnProperty("weapon_type")&&SmurfyApp.mechItemDetails.hasOwnProperty(armament.id)){armament.weapon_type=SmurfyApp.mechItemDetails[armament.id].weapon_type}else{armament.weapon_type="unknown"}});_.each(loadoutData.stats.ammunition,function(ammo){if(!ammo.hasOwnProperty("num_shots")&&SmurfyApp.mechItemDetails.hasOwnProperty(ammo.id)){ammo.num_shots=(SmurfyApp.mechItemDetails[ammo.id].num_shots||0)*ammo.count}});var hasElectronics=false,ecmInstalled=false,activeProbe=false,targetingComputer=undefined,commandConsole=false;_.each(loadoutData.stats.equipment,function(equipment){var equipmentName=equipment.name.toLowerCase();if(equipmentName.indexOf("ecm")!=-1){hasElectronics=true;ecmInstalled=true}else if(equipmentName.indexOf("active probe")!=-1){hasElectronics=true;activeProbe=true}else if(equipmentName.indexOf("targeting comp")!=-1){hasElectronics=true;targetingComputer=equipment.name}else if(equipmentName.indexOf("command console")!=-1){hasElectronics=true;commandConsole=true}});var upgrades=[];_.each(loadoutData.upgrades,function(upgrade){var upgradeName=upgrade.name.toLowerCase();if(upgradeName.indexOf("standard")==-1){switch(upgrade.type){case"Armor":upgrades.push({category:"Armor",name:"Ferro-Fibrous"});break;case"Structure":upgrades.push({category:"Structure",name:"Endo-Steel"});break;case"HeatSink":upgrades.push({category:"Heat Sinks",name:"Double"});break;case"Artemis":upgrades.push({category:"Guidance",name:"Artemis"});break}}});var displayData={compactClass:SmurfyApp.useCompactStats?"dsmd-compact":"",shortName:chassisData.translated_short_name,imgVisibilityClass:SmurfyApp.currentImageState==SmurfyApp.ImageState.faded?"dsmd-compact":"",imgSrc:"http://mwo.smurfy-net.de/assetic/img/tt_image/"+chassisData.name+".png",isStock:dataID.loadout.toLowerCase()==="stock",usedArmor:loadoutData.stats.used_armor,maxArmor:chassisData.details.max_armor,firepower:loadoutData.stats.firepower,dpsSustained:SmurfyApp.roundValue(loadoutData.stats.dps_sustained),dpsMax:SmurfyApp.roundValue(loadoutData.stats.dps_max),coolingEfficiency:loadoutData.stats.cooling_efficiency,topSpeed:loadoutData.stats.top_speed?SmurfyApp.roundValue(loadoutData.stats.top_speed):0,topSpeedTweak:loadoutData.stats.top_speed_tweak?SmurfyApp.roundValue(loadoutData.stats.top_speed_tweak):0,movementArchetype:chassisData.details.tuning_config.MovementArchetype,armaments:loadoutData.stats.armaments,engineType:loadoutData.stats.engine_type,engineRating:loadoutData.stats.engine_rating,jumpJets:(loadoutData.stats.used_jump_jets||0)+(loadoutData.stats.granted_jump_jets||0),jumpJetsMax:chassisData.details.jump_jets,heatSinks:loadoutData.stats.heatsinks||0,hasElectronics:hasElectronics,ecmInstalled:ecmInstalled,activeProbe:activeProbe,targetingComputer:targetingComputer,commandConsole:commandConsole,ammunition:loadoutData.stats.ammunition,upgrades:upgrades,isValid:loadoutData.valid,createdDate:SmurfyApp.parseCreateDate(loadoutData.created_at)};viewBody.append(SmurfyApp.panelMechStatsTemplate(displayData))};SmurfyApp.appendMechComponentsPanel=function(container,dataID){var chassisData=SmurfyApp.cachedChassis[dataID.chassis],loadoutData=SmurfyApp.cachedLoadouts[dataID.key()],emptyCellValue=undefined;var buildPairedArray=function(component1Name,component2Name){var ret=[[],[]];var itemArray1=[],itemArray2=[];for(var i=0,ticker=0;i<loadoutData.configuration.length;++i){if(loadoutData.configuration[i].name===component1Name){itemArray1=loadoutData.configuration[i].items;ticker++}else if(loadoutData.configuration[i].name===component2Name){itemArray2=loadoutData.configuration[i].items;ticker++}if(ticker===2){break}}var numElements=itemArray1.length>=itemArray2.length?itemArray1.length:itemArray2.length;if(numElements===0){ret[0].push(emptyCellValue);ret[1].push(emptyCellValue)}else{for(var i=0;i<numElements;++i){if(i<itemArray1.length){ret[0].push(itemArray1[i].name)}else{ret[0].push(emptyCellValue)}if(i<itemArray2.length){ret[1].push(itemArray2[i].name)}else{ret[1].push(emptyCellValue)}}}return ret};var buildArray=function(componentName){var ret=[];for(var i=0;i<loadoutData.configuration.length;++i){if(loadoutData.configuration[i].name===componentName){var itemArray=loadoutData.configuration[i].items;if(itemArray.length===0){ret.push(emptyCellValue)}else{for(var j=0;j<itemArray.length;++j){ret.push(itemArray[j].name)}}break}}return ret};var getArmor=function(componentName){for(var i=0;i<loadoutData.configuration.length;++i){if(loadoutData.configuration[i].name===componentName){return loadoutData.configuration[i].armor}}return 0};var displayData={legsItems:buildPairedArray("right_leg","left_leg"),armsItems:buildPairedArray("right_arm","left_arm"),torsosItems:buildPairedArray("right_torso","left_torso"),centerItems:buildArray("centre_torso"),headItems:buildArray("head"),rightLegArmor:getArmor("right_leg"),leftLegArmor:getArmor("left_leg"),rightArmArmor:getArmor("right_arm"),leftArmArmor:getArmor("left_arm"),rightTorsoArmor:getArmor("right_torso"),rightRearTorsoArmor:getArmor("right_torso_rear"),leftTorsoArmor:getArmor("left_torso"),leftRearTorsoArmor:getArmor("left_torso_rear"),centerTorsoArmor:getArmor("centre_torso"),centerRearTorsoArmor:getArmor("centre_torso_rear"),headArmor:getArmor("head")};if(SmurfyApp.useCompactComponents){container.find(".dsmd-body").append(SmurfyApp.panelMechComponentsCompactTemplate(displayData))}else{container.find(".dsmd-body").append(SmurfyApp.panelMechComponentsTemplate(displayData))}};SmurfyApp.expanderClickHandler=function(){var expander=jQuery(this);var container=expander.closest(".dsmd-container");expander.off("click");if(container.hasClass("dsmd-container-expanded")){container.trigger("toggleState")}else{var hasBuiltView=container.attr("data-built-view");if(hasBuiltView=="true"){container.trigger("toggleState")}else{SmurfyApp.setExpanderState(expander,"loading");SmurfyApp.getMechData(container,expander);container.on("viewBuilt",function(){container.trigger("toggleState")})}}};SmurfyApp.anchorClickHandler=function(e){e.preventDefault();var anchor=jQuery(this),selectedType=anchor.data("display-panel-type"),container=anchor.closest(".dsmd-container"),currentType=container.attr("data-selected-panel");if(selectedType==currentType){return}var newPanel=container.find((selectedType==SmurfyApp.PanelType.components&&SmurfyApp.useCompactComponents?".dsmd-compact":":not(.dsmd-compact)")+"[data-panel-type="+selectedType+"]"),currentPanel=container.find("[data-panel-type="+currentType+"]"),dataID=new SmurfyApp.DataID(container.data("chassis-id"),container.data("loadout-id"));currentPanel.addClass("dsmd-hidden");switch(selectedType){case SmurfyApp.PanelType.stats:if(!newPanel.length){container.append(SmurfyApp.appendMechStatsPanel(container,dataID))}else{newPanel.removeClass("dsmd-hidden")}break;case SmurfyApp.PanelType.components:if(!newPanel.length){container.append(SmurfyApp.appendMechComponentsPanel(container,dataID))}else{newPanel.removeClass("dsmd-hidden")}break;default:throw"Unsupported panel type."}var mySpan=anchor.closest("span"),allAnchors=mySpan.find("a");allAnchors.removeClass("active");anchor.addClass("active");if(SmurfyApp.updateImageState(container.width())){SmurfyApp.resizeContainerElements(container,true,false,false)}container.attr("data-selected-panel",selectedType)};jQuery(document).ready(function(){var singleContainer=jQuery(".dsmd-container").first();if(singleContainer.length===0){return}SmurfyApp.updateImageState(singleContainer.width());SmurfyApp.updateCompactStatsState(singleContainer.width());SmurfyApp.updateCompactComponentState(singleContainer.width());var urlBaseOverride=jQuery("body").attr("data-url-base");if(urlBaseOverride!==undefined){SmurfyApp.urlBase=urlBaseOverride}var uri=SmurfyApp.parseUri(SmurfyApp.urlBase);SmurfyApp.urlBase=uri.protocol+"://"+uri.authority+uri.path+uri.file;jQuery("body").append(SmurfyApp.errorTemplate());SmurfyApp.errorMessage=jQuery.extend(SmurfyApp.errorMessage,jQuery("#dsmd-expander-error"));jQuery(".dsmd-container").on("toggleState",function(){var container=jQuery(this);container.toggleClass("dsmd-expanded");if(!SmurfyApp.Modernizr.csstransitions||!container.hasClass("dsmd-animation")){container.trigger("transitionend")}}).on("transitionend",function(){var container=jQuery(this);var expander=container.find(".dsmd-expander");if(SmurfyApp.hasExpanderStateClasses(expander,"loading")||SmurfyApp.hasExpanderStateClasses(expander,"open")){SmurfyApp.setExpanderState(expander,"close");container.find(".dsmd-view-buttons").removeClass("dsmd-hidden")}else{SmurfyApp.setExpanderState(expander,"open");container.find(".dsmd-view-buttons").addClass("dsmd-hidden")}expander.on("click",SmurfyApp.expanderClickHandler);container.removeClass("dsmd-animation")});jQuery(".dsmd-expander").on("click",SmurfyApp.expanderClickHandler);var resizeID;jQuery(window).resize(function(){clearTimeout(resizeID);resizeID=setTimeout(SmurfyApp.handleResizeComplete,200)})});SmurfyApp.errorTemplate=_.template('<div id="dsmd-expander-error" class="dsmd-expander-errormsg"></div>');SmurfyApp.viewBodyTemplate=_.template('   <div class="dsmd-body">     <span class="dsmd-view-buttons dsmd-hidden">       <ul>         <li><a href="#" title="Stats" class="active" data-display-panel-type="<%= SmurfyApp.PanelType.stats %>">          <%= isCompact ? "S" : "Stats" %>         </a></li>         <li><a href="#" title="Components" data-display-panel-type="<%= SmurfyApp.PanelType.components %>">          <%= isCompact ? "C" : "Components" %>         </a></li>       </ul>     </span>  </div>');SmurfyApp.panelMechStatsTemplate=_.template('   <div class="dsmd-panel <%= compactClass %>" data-panel-type="<%= SmurfyApp.PanelType.stats %>">     <span class="dsmd-mech-image <%= imgVisibilityClass %>">       <img src="<%= imgSrc %>">     </span>    <span class="dsmd-status <%= compactClass %> <% if ( !isValid ) { %>dsmd-invalid<% } %>"> Created: <%= createdDate %><% if ( !isValid ) { %> (Invalid)<% } %></span>     <div class="dsmd-subpanel <%= compactClass %>">       <ul>         <li class="dsmd-li-title">Stats</li>         <li>Chassis: <span class="dsmd-label dsmd-label-info"><%  if( isStock === true ) { %>Stock <% } %><%= shortName %>         </span></li>         <li>Armor: <span class="dsmd-label dsmd-label-dmg"><%= usedArmor %> / <%= maxArmor %></span></li>         <li>Firepower: <span class="dsmd-label dsmd-label-dmg"><%= firepower %></span></li>         <li>Sustained DPS: <span class="dsmd-label dsmd-label-dps"><%= dpsSustained %> dps</span></li>         <li>Max DPS: <span class="dsmd-label dsmd-label-dps"><%= dpsMax %> dps</span></li>         <li>Cool. Eff.: <span class="dsmd-label dsmd-label-cooling"><%= coolingEfficiency %>%</span></li>         <li>Move. Archetype: <span class="dsmd-label dsmd-label-info"><%= movementArchetype %></span></li>         <li>Speed: <span class="dsmd-label dsmd-label-info"><%= topSpeed %> kph</span></li>         <li>&nbsp; <span class="dsmd-label dsmd-label-success"><%= topSpeedTweak %> kph</span></li>       </ul>     </div>         <div class="dsmd-subpanel <%= compactClass %>">       <ul>         <li class="dsmd-li-title">Armaments</li>         <%  if( armaments === undefined || armaments.length == 0 ) { %>               <li><em>None</em></li>         <%  } else {                _.each( armaments, function( armament ){ %>                 <li><%= armament.name %>&nbsp;<span class="dsmd-label dsmd-label-mech-hardpoint-<%= armament.weapon_type %>"><%= armament.count %></span></li>         <%    } );              } %>         <li class="dsmd-li-title">Equipment</li>         <li>Engine:         <%  if( engineType === undefined ) { %>               <span class="dsmd-label dsmd-label-warning">No Engine</span>         <%  } else {  %>               <span class="dsmd-label dsmd-label-info"><%= engineType %> <%= engineRating %></span>         <%  } %>         </li>         <li>Heatsinks:         <%  if( heatSinks === 0 ) { %>               <span class="dsmd-label dsmd-label-warning">0</span>         <%  } else {  %>               <span class="dsmd-label dsmd-label-hs"><%= heatSinks %></span>         <%  } %>         </li>         <%  if( jumpJetsMax !== undefined && jumpJetsMax > 0 ) { %>               <li>Jump Jets: <span class="dsmd-label dsmd-label-info"><%= jumpJets %> of <%= jumpJetsMax %></span></li>         <%  } %>         <%  if( hasElectronics === true ) { %>             <li class="dsmd-li-title">Electronic Systems</li>         <%  } %>         <%  if( ecmInstalled === true ) { %>               <li>&nbsp;<span class="dsmd-label dsmd-label-left dsmd-label-info">ECM</span></li>         <%  } %>         <%  if( activeProbe === true ) { %>               <li>&nbsp;<span class="dsmd-label dsmd-label-left dsmd-label-info">Active Probe</span></li>         <%  } %>         <%  if( targetingComputer !== undefined ) { %>               <li>&nbsp;<span class="dsmd-label dsmd-label-left dsmd-label-info"><%= targetingComputer %></span></li>         <%  } %>         <%  if( commandConsole === true ) { %>               <li>&nbsp;<span class="dsmd-label dsmd-label-left dsmd-label-info">Command Console</span></li>         <%  } %>       </ul>     </div>         <div class="dsmd-subpanel <%= compactClass %>">       <ul>         <li class="dsmd-li-title">Ammunition</li>         <%  if( ammunition === undefined || ammunition.length == 0 ) { %>               <li><em>None</em></li>         <%  } else {                _.each( ammunition, function( ammo ) { %>                 <li><%= ammo.name %>&nbsp;<span class="dsmd-label dsmd-label-success"><%= ammo.num_shots %></span></li>         <%    } );              } %>         <%  if( upgrades.length > 0 ) { %>             <li class="dsmd-li-title">Upgrades</li>         <%    _.each( upgrades, function( upgrade ) { %>                 <li><%= upgrade.category %>&nbsp;<span class="dsmd-label dsmd-label-success"><%= upgrade.name %></span></li>         <%    } );             } %>       </ul>     </div>   </div>');SmurfyApp.panelMechComponentsTemplate=_.template(' <div class="dsmd-panel dsmd-column" data-panel-type="<%= SmurfyApp.PanelType.components %>">   <div class="dsmd-subpanel dsmd-column">     <div style="height: 30px"></div>     <%= SmurfyApp.cellMechComponentTemplate( { title: "Right Arm", items: armsItems[0], armor: rightArmArmor, rearArmor: undefined, isCompact: false } ) %>   </div><div class="dsmd-subpanel dsmd-column">     <div style="height: 15px"></div>     <%= SmurfyApp.cellMechComponentTemplate( { title: "Right Torso", items: torsosItems[0], armor: rightTorsoArmor, rearArmor: rightRearTorsoArmor, isCompact: false } ) %>     <%= SmurfyApp.cellMechComponentTemplate( { title: "Right Leg", items: legsItems[0], armor: rightLegArmor, rearArmor: undefined, isCompact: false } ) %>   </div><div class="dsmd-subpanel dsmd-column">     <%= SmurfyApp.cellMechComponentTemplate( { title: "Head", items: headItems, armor: headArmor, rearArmor: undefined, isCompact: false } ) %>     <%= SmurfyApp.cellMechComponentTemplate( { title: "Center Torso", items: centerItems, armor: centerTorsoArmor, rearArmor: centerRearTorsoArmor, isCompact: false } ) %>   </div><div class="dsmd-subpanel dsmd-column">     <div style="height: 15px"></div>     <%= SmurfyApp.cellMechComponentTemplate( { title: "Left Torso", items: torsosItems[1], armor: leftTorsoArmor, rearArmor: leftRearTorsoArmor, isCompact: false } ) %>     <%= SmurfyApp.cellMechComponentTemplate( { title: "Left Leg", items: legsItems[1], armor: leftLegArmor, rearArmor: undefined, isCompact: false } ) %>   </div><div class="dsmd-subpanel dsmd-column">     <div style="height: 30px"></div>     <%= SmurfyApp.cellMechComponentTemplate( { title: "Left Arm", items: armsItems[1], armor: leftArmArmor, rearArmor: undefined, isCompact: false } ) %>   </div> </div>');SmurfyApp.panelMechComponentsCompactTemplate=_.template('  <div class="dsmd-panel dsmd-compact" data-panel-type="<%= SmurfyApp.PanelType.components %>">     <div class="dsmd-subpanel dsmd-compact">       <%= SmurfyApp.cellMechComponentTemplate( { title: "Head", items: headItems, armor: headArmor, rearArmor: undefined, isCompact: true } ) %>       <%= SmurfyApp.cellMechComponentTemplate( { title: "Center Torso", items: centerItems, armor: centerTorsoArmor, rearArmor: centerRearTorsoArmor, isCompact: true } ) %>       <%= SmurfyApp.cellMechComponentTemplate( { title: "Right Torso", items: torsosItems[0], armor: rightTorsoArmor, rearArmor: rightRearTorsoArmor, isCompact: true } ) %>       <%= SmurfyApp.cellMechComponentTemplate( { title: "Left Torso", items: torsosItems[1], armor: leftTorsoArmor, rearArmor: leftRearTorsoArmor, isCompact: true } ) %>       <%= SmurfyApp.cellMechComponentTemplate( { title: "Right Arm", items: armsItems[0], armor: rightArmArmor, rearArmor: undefined, isCompact: true } ) %>       <%= SmurfyApp.cellMechComponentTemplate( { title: "Left Arm", items: armsItems[1], armor: leftArmArmor, rearArmor: undefined, isCompact: true } ) %>       <%= SmurfyApp.cellMechComponentTemplate( { title: "Right Leg", items: legsItems[0], armor: rightLegArmor, rearArmor: undefined, isCompact: true } ) %>       <%= SmurfyApp.cellMechComponentTemplate( { title: "Left Leg", items: legsItems[1], armor: leftLegArmor, rearArmor: undefined, isCompact: true } ) %>     </div>   </div>');SmurfyApp.cellMechComponentTemplate=_.template('<div class="dsmd-column-cell">      <ul>        <li class="dsmd-li-title"><%= title %>&nbsp;<span class="dsmd-label dsmd-label-info"><%= armor %>        <% if( rearArmor !== undefined ) { %>          (<%= rearArmor %>)        <% } %></span></li>        <%  _.each( items, function( item ) {             if( item === undefined ) {               if( isCompact ) {                 return true;               } else { %>                 <li>&nbsp;</li>        <%     }             } else { %>               <li><%= item %></li>        <%   }           } ); %>      </ul>    </div>');SmurfyApp.mechItemDetails={1000:{display_name:"AC/20",type:"weapon",weapon_type:"ballistic"},1001:{display_name:"MEDIUM LASER",type:"weapon",weapon_type:"energy"},1002:{display_name:"LRM 20",type:"weapon",weapon_type:"missile"},1003:{display_name:"SMALL LASER",type:"weapon",weapon_type:"energy"},1004:{display_name:"SRM 4",type:"weapon",weapon_type:"missile"},1005:{display_name:"ER LARGE LASER",type:"weapon",weapon_type:"energy"},1006:{display_name:"ER PPC",type:"weapon",weapon_type:"energy"},1007:{display_name:"FLAMER",type:"weapon",weapon_type:"energy"},1008:{display_name:"LARGE LASER",type:"weapon",weapon_type:"energy"},1009:{display_name:"PPC",type:"weapon",weapon_type:"energy"},1010:{display_name:"LRG PULSE LASER",type:"weapon",weapon_type:"energy"},1011:{display_name:"MED PULSE LASER",type:"weapon",weapon_type:"energy"},1012:{display_name:"SML PULSE LASER",type:"weapon",weapon_type:"energy"},1014:{display_name:"AMS",type:"weapon",weapon_type:"ams"},1018:{display_name:"AC/2",type:"weapon",weapon_type:"ballistic"},1019:{display_name:"AC/5",type:"weapon",weapon_type:"ballistic"},1020:{display_name:"AC/10",type:"weapon",weapon_type:"ballistic"},1021:{display_name:"GAUSS RIFLE",type:"weapon",weapon_type:"ballistic"},1023:{display_name:"LB 10-X AC",type:"weapon",weapon_type:"ballistic"},1024:{display_name:"MACHINE GUN",type:"weapon",weapon_type:"ballistic"},1025:{display_name:"ULTRA AC/5",type:"weapon",weapon_type:"ballistic"},1026:{display_name:"LRM 5",type:"weapon",weapon_type:"missile"},1027:{display_name:"LRM 10",type:"weapon",weapon_type:"missile"},1028:{display_name:"LRM 15",type:"weapon",weapon_type:"missile"},1029:{display_name:"NARC",type:"weapon",weapon_type:"missile"},1030:{display_name:"SRM 2",type:"weapon",weapon_type:"missile"},1031:{display_name:"SRM 6",type:"weapon",weapon_type:"missile"},1032:{display_name:"STREAK SRM 2",type:"weapon",weapon_type:"missile"},1037:{display_name:"TAG",type:"weapon",weapon_type:"energy"},1038:{display_name:"SRM 2 + ARTEMIS",type:"weapon",weapon_type:"missile"},1039:{display_name:"SRM 4 + ARTEMIS",type:"weapon",weapon_type:"missile"},1040:{display_name:"SRM 6 + ARTEMIS",type:"weapon",weapon_type:"missile"},1041:{display_name:"LRM 5 + ARTEMIS",type:"weapon",weapon_type:"missile"},1042:{display_name:"LRM 10 + ARTEMIS",type:"weapon",weapon_type:"missile"},1043:{display_name:"LRM 15 + ARTEMIS",type:"weapon",weapon_type:"missile"},1044:{display_name:"LRM 20 + ARTEMIS",type:"weapon",weapon_type:"missile"},1200:{display_name:"C-LB2-X AC",type:"weapon",weapon_type:"ballistic"},1201:{display_name:"C-LB5-X AC",type:"weapon",weapon_type:"ballistic"},1202:{display_name:"C-LB10-X AC",type:"weapon",weapon_type:"ballistic"},1203:{display_name:"C-LB20-X AC",type:"weapon",weapon_type:"ballistic"},1204:{display_name:"C-ULTRA AC/2",type:"weapon",weapon_type:"ballistic"},1205:{display_name:"C-ULTRA AC/5",type:"weapon",weapon_type:"ballistic"},1206:{display_name:"C-ULTRA AC/10",type:"weapon",weapon_type:"ballistic"},1207:{display_name:"C-ULTRA AC/20",type:"weapon",weapon_type:"ballistic"},1208:{display_name:"C-GAUSS RIFLE",type:"weapon",weapon_type:"ballistic"},1209:{display_name:"C-MACHINE GUN",type:"weapon",weapon_type:"ballistic"},1210:{display_name:"C-FLAMER",type:"weapon",weapon_type:"energy"},1211:{display_name:"C-ER SML LASER",type:"weapon",weapon_type:"energy"},1212:{display_name:"C-ER MED LASER",type:"weapon",weapon_type:"energy"},1213:{display_name:"C-ER LRG LASER",type:"weapon",weapon_type:"energy"},1214:{display_name:"C-SML PULSE LASER",type:"weapon",weapon_type:"energy"},1215:{display_name:"C-MED PULSE LASER",type:"weapon",weapon_type:"energy"},1216:{display_name:"C-LRG PULSE LASER",type:"weapon",weapon_type:"energy"},1217:{display_name:"C-ER PPC",type:"weapon",weapon_type:"energy"},1218:{display_name:"C-LRM 5",type:"weapon",weapon_type:"missile"},1219:{display_name:"C-LRM 10",type:"weapon",weapon_type:"missile"},1220:{display_name:"C-LRM 15",type:"weapon",weapon_type:"missile"},1221:{display_name:"C-LRM 20",type:"weapon",weapon_type:"missile"},1222:{display_name:"C-LRM 5 + ARTEMIS",type:"weapon",weapon_type:"missile"},1223:{display_name:"C-LRM 10 + ARTEMIS",type:"weapon",weapon_type:"missile"},1224:{display_name:"C-LRM 15 + ARTEMIS",type:"weapon",weapon_type:"missile"},1225:{display_name:"C-LRM 20 + ARTEMIS",type:"weapon",weapon_type:"missile"},1226:{display_name:"C-SRM 2",type:"weapon",weapon_type:"missile"},1227:{display_name:"C-SRM 4",type:"weapon",weapon_type:"missile"},1228:{display_name:"C-SRM 6",type:"weapon",weapon_type:"missile"},1229:{display_name:"C-SRM 2 + ARTEMIS",type:"weapon",weapon_type:"missile"},1230:{display_name:"C-SRM 4 + ARTEMIS",type:"weapon",weapon_type:"missile"},1231:{display_name:"C-SRM 6 + ARTEMIS",type:"weapon",weapon_type:"missile"},1232:{display_name:"C-STREAK SRM 2",type:"weapon",weapon_type:"missile"},1233:{display_name:"C-STREAK SRM 4",type:"weapon",weapon_type:"missile"},1234:{display_name:"C-STREAK SRM 6",type:"weapon",weapon_type:"missile"},1235:{display_name:"C-NARC",type:"weapon",weapon_type:"missile"},1236:{display_name:"C-TAG",type:"weapon",weapon_type:"energy"},1237:{display_name:"C-AMS",type:"weapon",weapon_type:"ams"},1238:{display_name:"C-AC/2",type:"weapon",weapon_type:"ballistic"},1239:{display_name:"C-AC/5",type:"weapon",weapon_type:"ballistic"},1240:{display_name:"C-AC/10",type:"weapon",weapon_type:"ballistic"},1241:{display_name:"C-AC/20",type:"weapon",weapon_type:"ballistic"},2000:{display_name:"AC/20 AMMO",num_shots:"7",type:"ammo"},2001:{display_name:"AMS AMMO",num_shots:"2000",type:"ammo"},2005:{display_name:"AC/2 AMMO",num_shots:"75",type:"ammo"},2006:{display_name:"AC/5 AMMO",num_shots:"30",type:"ammo"},2007:{display_name:"AC/10 AMMO",num_shots:"15",type:"ammo"},2008:{display_name:"GAUSS AMMO",num_shots:"10",type:"ammo"},2010:{display_name:"LB 10-X AMMO",num_shots:"15",type:"ammo"},2011:{display_name:"MACHINE GUN AMMO",num_shots:"2000",type:"ammo"},2012:{display_name:"U-AC/5 AMMO",num_shots:"30",type:"ammo"},2017:{display_name:"NARC AMMO",num_shots:"12",type:"ammo"},2027:{display_name:"LRM AMMO",num_shots:"180",type:"ammo"},2028:{display_name:"SRM AMMO",num_shots:"100",type:"ammo"},2029:{display_name:"STREAK SRM AMMO",num_shots:"100",type:"ammo"},2030:{display_name:"LRM AMMO + ARTEMIS IV",num_shots:"180",type:"ammo"},2031:{display_name:"SRM AMMO + ARTEMIS IV",num_shots:"100",type:"ammo"},2032:{display_name:"AC/20 AMMO (1/2)",num_shots:"3",type:"ammo"},2033:{display_name:"AMS AMMO (1/2)",num_shots:"1000",type:"ammo"},2034:{display_name:"AC/2 AMMO (1/2)",num_shots:"37",type:"ammo"},2035:{display_name:"AC/5 AMMO (1/2)",num_shots:"15",type:"ammo"},2036:{display_name:"AC/10 AMMO (1/2)",num_shots:"7",type:"ammo"},2037:{display_name:"GAUSS AMMO (1/2)",num_shots:"5",type:"ammo"},2038:{display_name:"LB 10-X AMMO (1/2)",num_shots:"7",type:"ammo"},2039:{display_name:"MACHINE GUN AMMO (1/2)",num_shots:"1000",type:"ammo"},2040:{display_name:"U-AC/5 AMMO (1/2)",num_shots:"15",type:"ammo"},2041:{display_name:"NARC AMMO (1/2)",num_shots:"6",type:"ammo"},2042:{display_name:"LRM AMMO (1/2)",num_shots:"90",type:"ammo"},2043:{display_name:"SRM AMMO (1/2)",num_shots:"50",type:"ammo"},2044:{display_name:"STREAK SRM AMMO (1/2)",num_shots:"50",type:"ammo"},2045:{display_name:"LRM AMMO + ARTEMIS IV (1/2)",num_shots:"90",type:"ammo"},2046:{display_name:"SRM AMMO + ART. IV (1/2)",num_shots:"50",type:"ammo"},2200:{display_name:"C-LB 2-X AC AMMO",num_shots:"75",type:"ammo"},2201:{display_name:"C-AC/2 AMMO",num_shots:"150",type:"ammo"},2202:{display_name:"C-LB 5-X AC AMMO",num_shots:"30",type:"ammo"},2203:{display_name:"C-AC/5 AMMO",num_shots:"90",type:"ammo"},2204:{display_name:"C-LB 10-X AMMO",num_shots:"15",type:"ammo"},2205:{display_name:"C-AC/10 AMMO",num_shots:"60",type:"ammo"},2206:{display_name:"C-LB 20-X AMMO",num_shots:"7",type:"ammo"},2207:{display_name:"C-AC/20 AMMO",num_shots:"35",type:"ammo"},2208:{display_name:"C-U-AC/2 AMMO",num_shots:"150",type:"ammo"},2209:{display_name:"C-U-AC/5 AMMO",num_shots:"90",type:"ammo"},2210:{display_name:"C-U-AC/10 AMMO",num_shots:"60",type:"ammo"},2211:{display_name:"C-U-AC/20 AMMO",num_shots:"35",type:"ammo"},2212:{display_name:"C-GAUSS AMMO",num_shots:"10",type:"ammo"},2213:{display_name:"C-MG AMMO",num_shots:"2000",type:"ammo"},2214:{display_name:"C-LRM AMMO",num_shots:"180",type:"ammo"},2215:{display_name:"C-LRM AMMO + ART. IV",num_shots:"180",type:"ammo"},2216:{display_name:"C-SRM AMMO",num_shots:"100",type:"ammo"},2217:{display_name:"C-SRM AMMO + ART. IV",num_shots:"100",type:"ammo"},2218:{display_name:"C-S-SRM AMMO",num_shots:"100",type:"ammo"},2219:{display_name:"C-NARC AMMO",num_shots:"12",type:"ammo"},2220:{display_name:"C-LB 2-X AC AMMO (1/2)",num_shots:"37",type:"ammo"},2221:{display_name:"C-AC/2 AMMO (1/2)",num_shots:"74",type:"ammo"},2222:{display_name:"C-LB 5-X AC AMMO (1/2)",num_shots:"15",type:"ammo"},2223:{display_name:"C-AC/5 AMMO (1/2)",num_shots:"45",type:"ammo"},2224:{display_name:"C-LB 10-X AMMO (1/2)",num_shots:"7",type:"ammo"},2225:{display_name:"C-AC/10 AMMO (1/2)",num_shots:"28",type:"ammo"},2226:{display_name:"C-LB 20-X AMMO (1/2)",num_shots:"3",type:"ammo"},2227:{display_name:"C-AC/20 AMMO (1/2)",num_shots:"15",type:"ammo"},2228:{display_name:"C-U-AC/2 AMMO (1/2)",num_shots:"74",type:"ammo"},2229:{display_name:"C-U-AC/5 AMMO (1/2)",num_shots:"45",type:"ammo"},2230:{display_name:"C-U-AC/10 AMMO (1/2)",num_shots:"28",type:"ammo"},2231:{display_name:"C-U-AC/20 AMMO (1/2)",num_shots:"15",type:"ammo"},2232:{display_name:"C-GAUSS AMMO (1/2)",num_shots:"5",type:"ammo"},2233:{display_name:"C-MG AMMO (1/2)",num_shots:"1000",type:"ammo"},2234:{display_name:"C-LRM AMMO (1/2)",num_shots:"90",type:"ammo"},2235:{display_name:"C-LRM AMMO+ART. IV (1/2)",num_shots:"90",type:"ammo"},2236:{display_name:"C-SRM AMMO (1/2)",num_shots:"50",type:"ammo"},2237:{display_name:"C-SRM AMMO+ART. IV (1/2)",num_shots:"50",type:"ammo"},2238:{display_name:"C-S-SRM AMMO (1/2)",num_shots:"50",type:"ammo"},2239:{display_name:"C-NARC AMMO (1/2)",num_shots:"6",type:"ammo"},2240:{display_name:"C-AMS AMMO",num_shots:"2000",type:"ammo"},2241:{display_name:"C-AMS AMMO (1/2)",num_shots:"1000",type:"ammo"}};
SmurfyApp.Modernizr=function(a,b,c){function w(a){i.cssText=a}function x(a,b){return w(prefixes.join(a+";")+(b||""))}function y(a,b){return typeof a===b}function z(a,b){return!!~(""+a).indexOf(b)}function A(a,b){for(var d in a){var e=a[d];if(!z(e,"-")&&i[e]!==c)return b=="pfx"?e:!0}return!1}function B(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:y(f,"function")?f.bind(d||b):f}return!1}function C(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+m.join(d+" ")+d).split(" ");return y(b,"string")||y(b,"undefined")?A(e,b):(e=(a+" "+n.join(d+" ")+d).split(" "),B(e,b,c))}var d="2.8.3",e={},f=b.documentElement,g="modernizr",h=b.createElement(g),i=h.style,j,k={}.toString,l="Webkit Moz O ms",m=l.split(" "),n=l.toLowerCase().split(" "),o={},p={},q={},r=[],s=r.slice,t,u={}.hasOwnProperty,v;!y(u,"undefined")&&!y(u.call,"undefined")?v=function(a,b){return u.call(a,b)}:v=function(a,b){return b in a&&y(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=s.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(s.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(s.call(arguments)))};return e}),o.csstransitions=function(){return C("transition")};for(var D in o)v(o,D)&&(t=D.toLowerCase(),e[t]=o[D](),r.push((e[t]?"":"no-")+t));return e.addTest=function(a,b){if(typeof a=="object")for(var d in a)v(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof enableClasses!="undefined"&&enableClasses&&(f.className+=" "+(b?"":"no-")+a),e[a]=b}return e},w(""),h=j=null,e._version=d,e._domPrefixes=n,e._cssomPrefixes=m,e.testProp=function(a){return A([a])},e.testAllProps=C,e}(this,this.document);